<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="775.5px" preserveAspectRatio="none" style="width:877px;height:775px;" version="1.1" viewBox="0 0 877 775" width="877.5px" zoomAndPan="magnify"><defs><filter height="300%" id="f1nnnyabobiipq" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="3.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="6.0" dy="6.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="21" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="103.5" x="381.75" y="34.4927">tlsrouter</text><rect fill="#ADD8E6" height="707.6836" style="stroke: #A80036; stroke-width: 1.5;" width="405" x="106.5" y="51.4453"/><text fill="#000000" font-family="sans-serif" font-size="19.5" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="283.5" x="167.25" y="69.5457">Service Namespace (id:x)</text><rect fill="#FFFFFF" height="707.6836" style="stroke: #A80036; stroke-width: 1.5;" width="346.5" x="514.5" y="51.4453"/><text fill="#000000" font-family="sans-serif" font-size="19.5" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="286.5" x="544.5" y="69.5457">Default Namespace (id:0)</text><line style="stroke: #A80036; stroke-width: 1.5; stroke-dasharray: 5.0,5.0;" x1="54" x2="54" y1="173.5898" y2="661.1836"/><line style="stroke: #A80036; stroke-width: 1.5; stroke-dasharray: 5.0,5.0;" x1="201" x2="201" y1="173.5898" y2="661.1836"/><line style="stroke: #A80036; stroke-width: 1.5; stroke-dasharray: 5.0,5.0;" x1="405" x2="405" y1="173.5898" y2="661.1836"/><line style="stroke: #A80036; stroke-width: 1.5; stroke-dasharray: 5.0,5.0;" x1="625.5" x2="625.5" y1="173.5898" y2="661.1836"/><line style="stroke: #A80036; stroke-width: 1.5; stroke-dasharray: 5.0,5.0;" x1="799.5" x2="799.5" y1="173.5898" y2="661.1836"/><text fill="#000000" font-family="sans-serif" font-size="21" lengthAdjust="spacingAndGlyphs" textLength="76.5" x="12" y="168.6372">kubectl</text><ellipse cx="54.75" cy="125.1445" fill="#FEFECE" filter="url(#f1nnnyabobiipq)" rx="18" ry="18" style="stroke: #A80036; stroke-width: 3.0;"/><line style="stroke: #A80036; stroke-width: 3.0;" x1="36.75" x2="72.75" y1="146.1445" y2="146.1445"/><text fill="#000000" font-family="sans-serif" font-size="21" lengthAdjust="spacingAndGlyphs" textLength="76.5" x="12" y="679.1763">kubectl</text><ellipse cx="54.75" cy="708.1289" fill="#FEFECE" filter="url(#f1nnnyabobiipq)" rx="18" ry="18" style="stroke: #A80036; stroke-width: 3.0;"/><line style="stroke: #A80036; stroke-width: 3.0;" x1="36.75" x2="72.75" y1="729.1289" y2="729.1289"/><text fill="#000000" font-family="sans-serif" font-size="21" lengthAdjust="spacingAndGlyphs" textLength="168" x="112.5" y="168.6372">tlsrouter-service</text><ellipse cx="201" cy="125.1445" fill="#FEFECE" filter="url(#f1nnnyabobiipq)" rx="18" ry="18" style="stroke: #A80036; stroke-width: 3.0;"/><line style="stroke: #A80036; stroke-width: 3.0;" x1="183" x2="219" y1="146.1445" y2="146.1445"/><text fill="#000000" font-family="sans-serif" font-size="21" lengthAdjust="spacingAndGlyphs" textLength="168" x="112.5" y="679.1763">tlsrouter-service</text><ellipse cx="201" cy="708.1289" fill="#FEFECE" filter="url(#f1nnnyabobiipq)" rx="18" ry="18" style="stroke: #A80036; stroke-width: 3.0;"/><line style="stroke: #A80036; stroke-width: 3.0;" x1="183" x2="219" y1="729.1289" y2="729.1289"/><text fill="#000000" font-family="sans-serif" font-size="21" lengthAdjust="spacingAndGlyphs" textLength="192" x="304.5" y="168.6372">tlsrouter-container</text><ellipse cx="405" cy="125.1445" fill="#FEFECE" filter="url(#f1nnnyabobiipq)" rx="18" ry="18" style="stroke: #A80036; stroke-width: 3.0;"/><line style="stroke: #A80036; stroke-width: 3.0;" x1="387" x2="423" y1="146.1445" y2="146.1445"/><text fill="#000000" font-family="sans-serif" font-size="21" lengthAdjust="spacingAndGlyphs" textLength="192" x="304.5" y="679.1763">tlsrouter-container</text><ellipse cx="405" cy="708.1289" fill="#FEFECE" filter="url(#f1nnnyabobiipq)" rx="18" ry="18" style="stroke: #A80036; stroke-width: 3.0;"/><line style="stroke: #A80036; stroke-width: 3.0;" x1="387" x2="423" y1="729.1289" y2="729.1289"/><text fill="#000000" font-family="sans-serif" font-size="21" lengthAdjust="spacingAndGlyphs" textLength="201" x="520.5" y="168.6372">kubernetes-service</text><ellipse cx="625.5" cy="125.1445" fill="#FEFECE" filter="url(#f1nnnyabobiipq)" rx="18" ry="18" style="stroke: #A80036; stroke-width: 3.0;"/><line style="stroke: #A80036; stroke-width: 3.0;" x1="607.5" x2="643.5" y1="146.1445" y2="146.1445"/><text fill="#000000" font-family="sans-serif" font-size="21" lengthAdjust="spacingAndGlyphs" textLength="201" x="520.5" y="679.1763">kubernetes-service</text><ellipse cx="625.5" cy="708.1289" fill="#FEFECE" filter="url(#f1nnnyabobiipq)" rx="18" ry="18" style="stroke: #A80036; stroke-width: 3.0;"/><line style="stroke: #A80036; stroke-width: 3.0;" x1="607.5" x2="643.5" y1="729.1289" y2="729.1289"/><text fill="#000000" font-family="sans-serif" font-size="21" lengthAdjust="spacingAndGlyphs" textLength="100.5" x="745.5" y="168.6372">certificate</text><path d="M773.25,95.1445 C773.25,80.1445 800.25,80.1445 800.25,80.1445 C800.25,80.1445 827.25,80.1445 827.25,95.1445 L827.25,134.1445 C827.25,149.1445 800.25,149.1445 800.25,149.1445 C800.25,149.1445 773.25,149.1445 773.25,134.1445 L773.25,95.1445 " fill="#FEFECE" filter="url(#f1nnnyabobiipq)" style="stroke: #000000; stroke-width: 2.25;"/><path d="M773.25,95.1445 C773.25,110.1445 800.25,110.1445 800.25,110.1445 C800.25,110.1445 827.25,110.1445 827.25,95.1445 " fill="none" style="stroke: #000000; stroke-width: 2.25;"/><text fill="#000000" font-family="sans-serif" font-size="21" lengthAdjust="spacingAndGlyphs" textLength="100.5" x="745.5" y="679.1763">certificate</text><path d="M773.25,699.1289 C773.25,684.1289 800.25,684.1289 800.25,684.1289 C800.25,684.1289 827.25,684.1289 827.25,699.1289 L827.25,738.1289 C827.25,753.1289 800.25,753.1289 800.25,753.1289 C800.25,753.1289 773.25,753.1289 773.25,738.1289 L773.25,699.1289 " fill="#FEFECE" filter="url(#f1nnnyabobiipq)" style="stroke: #000000; stroke-width: 2.25;"/><path d="M773.25,699.1289 C773.25,714.1289 800.25,714.1289 800.25,714.1289 C800.25,714.1289 827.25,714.1289 827.25,699.1289 " fill="none" style="stroke: #000000; stroke-width: 2.25;"/><polygon fill="#A80036" points="183,214.0898,198,220.0898,183,226.0898,189,220.0898" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="54.75" x2="192" y1="220.0898" y2="220.0898"/><text fill="#000000" font-family="sans-serif" font-size="19.5" lengthAdjust="spacingAndGlyphs" textLength="100.5" x="65.25" y="212.6902">L3/tcp/443</text><polygon fill="#A80036" points="387,257.7891,402,263.7891,387,269.7891,393,263.7891" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="201" x2="396" y1="263.7891" y2="263.7891"/><text fill="#000000" font-family="sans-serif" font-size="19.5" lengthAdjust="spacingAndGlyphs" textLength="120" x="211.5" y="256.3894">L4/https/443</text><polygon fill="#FBFB77" filter="url(#f1nnnyabobiipq)" points="208.5,283.4883,208.5,320.9883,426,320.9883,426,298.4883,411,283.4883,208.5,283.4883" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="411" x2="411" y1="283.4883" y2="298.4883"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="426" x2="411" y1="298.4883" y2="298.4883"/><ellipse cx="225.75" cy="302.4375" fill="#000000" rx="3.75" ry="3.75" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="19.5" lengthAdjust="spacingAndGlyphs" textLength="169.5" x="234" y="309.0886">TCP Pass-through</text><polygon fill="#A80036" points="607.5,360.1875,622.5,366.1875,607.5,372.1875,613.5,366.1875" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="405" x2="616.5" y1="366.1875" y2="366.1875"/><text fill="#000000" font-family="sans-serif" font-size="19.5" lengthAdjust="spacingAndGlyphs" textLength="120" x="415.5" y="358.7878">L4/https/443</text><polygon fill="#FBFB77" filter="url(#f1nnnyabobiipq)" points="412.5,385.8867,412.5,468.3867,628.5,468.3867,628.5,400.8867,613.5,385.8867,412.5,385.8867" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="613.5" x2="613.5" y1="385.8867" y2="400.8867"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="628.5" x2="613.5" y1="400.8867" y2="400.8867"/><ellipse cx="429.75" cy="404.8359" fill="#000000" rx="3.75" ry="3.75" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="19.5" lengthAdjust="spacingAndGlyphs" textLength="136.5" x="438" y="411.4871">SNI inspection</text><ellipse cx="429.75" cy="427.5352" fill="#000000" rx="3.75" ry="3.75" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="19.5" lengthAdjust="spacingAndGlyphs" textLength="156" x="438" y="434.1863">Routing decision</text><ellipse cx="429.75" cy="450.2344" fill="#000000" rx="3.75" ry="3.75" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="19.5" lengthAdjust="spacingAndGlyphs" textLength="168" x="438" y="456.8855">TLS Pass-through</text><polygon fill="#A80036" points="782.25,485.4844,797.25,491.4844,782.25,497.4844,788.25,491.4844" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="625.5" x2="791.25" y1="491.4844" y2="491.4844"/><polygon fill="#FBFB77" filter="url(#f1nnnyabobiipq)" points="633,510.9844,633,548.4844,832.5,548.4844,832.5,525.9844,817.5,510.9844,633,510.9844" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="817.5" x2="817.5" y1="510.9844" y2="525.9844"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="832.5" x2="817.5" y1="525.9844" y2="525.9844"/><ellipse cx="650.25" cy="529.9336" fill="#000000" rx="3.75" ry="3.75" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="19.5" lengthAdjust="spacingAndGlyphs" textLength="151.5" x="658.5" y="536.5847">TLS termination</text><polygon fill="#A80036" points="642,565.1836,627,571.1836,642,577.1836,636,571.1836" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="633" x2="798.75" y1="571.1836" y2="571.1836"/><polygon fill="#A80036" points="421.5,586.1836,406.5,592.1836,421.5,598.1836,415.5,592.1836" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="412.5" x2="624" y1="592.1836" y2="592.1836"/><polygon fill="#A80036" points="217.5,607.1836,202.5,613.1836,217.5,619.1836,211.5,613.1836" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="208.5" x2="403.5" y1="613.1836" y2="613.1836"/><polygon fill="#A80036" points="71.25,628.1836,56.25,634.1836,71.25,640.1836,65.25,634.1836" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="62.25" x2="199.5" y1="634.1836" y2="634.1836"/><!--
@startuml

scale 1.5
title tlsrouter

entity "kubectl" as kubectl

box "Service Namespace (id:x)" #lightblue
  entity "tlsrouter-service" as tlsrouter_service
  entity "tlsrouter-container" as tlsrouter_container
end box

box "Default Namespace (id:0)" #white
  entity "kubernetes-service" as kubernetes_service
  database "certificate" as certificate
end box

kubectl -> tlsrouter_service : L3/tcp/443
tlsrouter_service -> tlsrouter_container : L4/https/443
note right of tlsrouter_service
  * TCP Pass-through
end note
tlsrouter_container -> kubernetes_service : L4/https/443
note right of tlsrouter_container
  * SNI inspection
  * Routing decision
  * TLS Pass-through
end note
kubernetes_service -> certificate
note right of kubernetes_service
  * TLS termination
end note
certificate -> kubernetes_service
kubernetes_service -> tlsrouter_container
tlsrouter_container -> tlsrouter_service
tlsrouter_service -> kubectl

@enduml

PlantUML version 1.2017.19(Sun Nov 12 22:46:22 AEDT 2017)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_191-b12
Operating System: Linux
OS Version: 4.4.0-137-generic
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>